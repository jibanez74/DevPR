service: devprapi
frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x
  lambdaHashingVersion: 20201221
  environment:
    MONGO_URI: mongodb+srv://tester:testing123@enblanco.uhoqr.mongodb.net/<dbname>?retryWrites=true&w=majority
    PORT: 3000
    COGNITO_POOL_ID: us-east-1_pOVbIY1vA
    REGION: us-east-1
    NODE_ENV: development
  stage: dev
  region: us-east-1

resources:
  Resources:
    ApiGatewayAuthorizer:
      DependsOn:
        - ApiGatewayRestApi
      Type: AWS::ApiGateway::Authorizer
      Properties:
        Name: cognito-authorizer
        IdentitySource: method.request.header.Authorization
        RestApiId:
          Ref: ApiGatewayRestApi
        Type: COGNITO_USER_POOLS
        ProviderARNs:
          - arn:aws:cognito-idp:us-east-1:244883060857:userpool/us-east-1_pOVbIY1vA

functions:
  getProfiles:
    handler: src/server.api
    events:
      - http:
          method: get
          path: profile
          authorizer:
            type: COGNITO_USER_POOLS
            authorizerId:
              Ref: ApiGatewayAuthorizer

plugins:
  - serverless-offline
  - serverless-express
